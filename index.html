<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto"
      data-preview_width="400"
    />

    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto2"
      data-preview_width="200"
    />

    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto3"
      data-preview_width="500"
    />

    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
    <img
      style="width: 100px"
      src="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      href="https://pbs.twimg.com/profile_images/2555884936/42d62cbzu4e2jq1uimcn_400x400.jpeg"
      class="preview"
      alt="Nombre de la foto4"
      data-preview_width="600"
    />
  </body>

  <script>
    let xOffset;
    let yOffset;
    let border;
    let width;

    const elements = document.getElementsByClassName('preview');

    const addMouseOver = (e) => {
      xOffset = 25;
      yOffset = 25;
      border = 6;

      let width = e.target.dataset.preview_width;
      if (width === undefined) {
        width = 290;
      }

      let imagePreview = e.target.getAttribute('href');
      if (imagePreview === undefined) {
        e.target.getAttribute('src');
      }

      let text = e.target.getAttribute('alt');
      if (imagePreview === undefined) {
        const text = '';
      }

      const realWidth = width - border;
      // Create box element
      let previewBox = document.createElement('p');
      previewBox.setAttribute('id', 'preview');

      let imageBox = document.createElement('img');
      imageBox.style.cssText = `max-width:${realWidth}px`;
      imageBox.setAttribute('src', imagePreview);
      imageBox.setAttribute('alt', 'Image preview');

      let textBox = document.createElement('div');
      textBox.textContent = text;
      textBox.style.textAlign = 'center';
      textBox.style.width = '100%';
      textBox.style.color = '#DDD';
      textBox.style.marginTop = '5px';
      textBox.style.backgroundColor = '#555';

      previewBox.appendChild(imageBox);
      previewBox.appendChild(textBox);

      document.body.appendChild(previewBox);

      const $preview = document.getElementById('preview');
      $preview.style.display = 'block';
      $preview.style.position = 'absolute';
      $preview.style.width = width + 'px';
      $preview.style.border = `${border}px solid #CCCCCC`;
      fadeIn($preview, 600);
    };

    const addMouseout = () => {
      document.getElementById('preview').remove();
    };

    const addMousemove = (e) => {
      const $preview = document.getElementById('preview');
      var w = window,
        d = document,
        es = d.documentElement,
        g = d.getElementsByTagName('body')[0],
        window_width = w.innerWidth || es.clientWidth || g.clientWidth,
        window_height = w.innerHeight || es.clientHeight || g.clientHeight;

      let $x_mouse = e.pageX - window.pageXOffset;
      let $y_mouse = e.pageY - window.pageYOffset;
      let $xMax = window_width;
      let $yMax = window_height;

      let $x;
      let $y;

      if ($xMax / 2 < $x_mouse) {
        $x = e.pageX - width - xOffset;
      } else {
        $x = e.pageX + xOffset;
      }

      if ($yMax / 2 < $y_mouse) {
        if ($y_mouse > $preview.clientHeight + border) {
          $y = e.pageY - $preview.clientHeight - yOffset;
        } else {
          $y = window.pageYOffset;
        }
      } else {
        if ($yMax > $preview.clientHeight + $y_mouse + yOffset + border) {
          $y = e.pageY + yOffset;
        } else {
          $y = $yMax - $preview.clientWidth + window.pageYOffset - border;
        }
      }

      $preview.style.top = $y + 'px';
      $preview.style.left = $x + 'px';
      console.clear();
      console.log($yMax);
      console.log($y);
      console.log(e.target.dataset.preview_width);
      console.log(`left:${$x}px, top:${$y}px `);
    };

    for (let i = 0; i < elements.length; i++) {
      elements[i].addEventListener('mouseover', addMouseOver);
      elements[i].addEventListener('mouseout', addMouseout);
      elements[i].addEventListener('mousemove', addMousemove);
    }

    function fadeIn(element, duration = 200) {
      element.style.opacity = 0;
      var last = +new Date();
      var tick = function () {
        element.style.opacity =
          +element.style.opacity + (new Date() - last) / duration;
        last = +new Date();
        if (+element.style.opacity < 1) {
          (window.requestAnimationFrame && requestAnimationFrame(tick)) ||
            setTimeout(tick, 16);
        } else {
          element.style.opacity = null;
        }
      };
      tick();
    }
  </script>
</html>
